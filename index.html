<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dough Pro - Loaf Calculator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand: #f59e0b;
            --brand-dark: #d97706;
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #fafaf9;
            -webkit-tap-highlight-color: transparent;
        }
        .card {
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .input-pill {
            transition: all 0.2s ease;
            border: 2px solid #e7e5e4;
        }
        .input-pill:focus {
            border-color: var(--brand);
            outline: none;
            box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
        }
        
        .sticky-result {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: #1c1917;
            color: white;
            padding: 0.75rem 1.25rem;
            padding-bottom: calc(0.75rem + env(safe-area-inset-bottom, 0px));
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        main { 
            padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px)); 
        }

        /* Tooltip Logic */
        .has-tooltip {
            position: relative;
            display: inline-flex;
            align-items: center;
            cursor: help;
        }
        .tooltip {
            visibility: hidden;
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #1c1917;
            color: #fff;
            text-align: center;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.4;
            width: 220px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.4);
            pointer-events: none;
        }
        .tooltip::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: #1c1917 transparent transparent transparent;
        }
        .has-tooltip:hover .tooltip, .has-tooltip:active .tooltip {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }

        .animate-pop {
            animation: pop 0.3s ease-out;
        }
        @keyframes pop {
            0% { transform: scale(0.95); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="antialiased text-stone-900">

    <!-- Header -->
    <header class="max-w-4xl mx-auto px-6 pt-8 pb-4 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-extrabold tracking-tight">Dough<span class="text-amber-500">Pro</span></h1>
            <p class="text-xs font-semibold text-stone-500 uppercase tracking-wider">Professional Loaf Utilities</p>
        </div>
        <div class="flex gap-2">
            <button onclick="toggleUnits()" id="unitToggle" class="px-3 py-1 text-xs font-bold border-2 border-stone-200 rounded-full hover:bg-stone-100">METRIC (g)</button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 space-y-6">

        <!-- Volume Input Section -->
        <section class="card p-6 border border-stone-100">
            <div class="flex items-center justify-between mb-4">
                <h2 class="font-bold text-lg flex items-center gap-2">
                    <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    Tin Dimensions
                </h2>
                <button onclick="saveCurrentTin()" class="text-xs font-bold text-amber-600 hover:text-amber-700 uppercase tracking-tighter">+ Save</button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <div class="flex items-center gap-1.5 mb-1.5 ml-1">
                        <label class="block text-xs font-bold text-stone-500 uppercase">Water weight to fill line</label>
                        <span class="has-tooltip">
                            <svg class="w-4 h-4 text-stone-300 hover:text-amber-500 transition-colors" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path></svg>
                            <div class="tooltip">Place your empty tin on a scale, zero (tare) it, then fill with water to the top. The weight of that water tells us the exact volume of your tin.</div>
                        </span>
                    </div>
                    <div class="relative">
                        <input type="number" 
                               id="tinVolume" 
                               value="1500" 
                               oninput="calculate()" 
                               inputmode="decimal" 
                               pattern="[0-9]*"
                               class="input-pill w-full p-4 rounded-2xl text-xl font-bold bg-stone-50">
                        <span class="absolute right-4 top-1/2 -translate-y-1/2 font-bold text-stone-400 unit-label">g</span>
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setRatio(1.78, this)" class="ratio-btn has-tooltip p-3 rounded-xl border-2 border-stone-100 text-[10px] sm:text-xs font-bold bg-white hover:border-amber-200 transition active shadow-sm" data-val="1.78">
                        WHITE<br>1.78
                        <div class="tooltip">Standard ratio for white flour loaves to fill the tin perfectly.</div>
                    </button>
                    <button onclick="setRatio(1.71, this)" class="ratio-btn has-tooltip p-3 rounded-xl border-2 border-stone-100 text-[10px] sm:text-xs font-bold bg-white hover:border-amber-200 transition shadow-sm" data-val="1.71">
                        MIXED<br>1.71
                        <div class="tooltip">Adjusted for loaves using 20-50% whole wheat or rye.</div>
                    </button>
                    <button onclick="setRatio(1.66, this)" class="ratio-btn has-tooltip p-3 rounded-xl border-2 border-stone-100 text-[10px] sm:text-xs font-bold bg-white hover:border-amber-200 transition shadow-sm" data-val="1.66">
                        WHOLE<br>1.66
                        <div class="tooltip">Dense 100% whole grain loaves need less dough weight to fill a tin.</div>
                    </button>
                </div>
            </div>
        </section>

        <!-- Hydration and Customization -->
        <section class="card p-6 border border-stone-100">
            <h2 class="font-bold text-lg mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                Recipe Profile
            </h2>

            <div class="bg-amber-50 p-4 rounded-2xl mb-6">
                <div class="flex items-center gap-1.5 mb-1.5 ml-1">
                    <label class="block text-xs font-bold text-amber-900 uppercase">Target Hydration (%)</label>
                    <span class="has-tooltip">
                        <svg class="w-4 h-4 text-amber-300 hover:text-amber-600 transition-colors" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path></svg>
                        <div class="tooltip">The ratio of liquid to flour. Higher % makes the bread softer but the dough stickier and harder to handle. 65% is standard for beginners.</div>
                    </span>
                </div>
                <div class="relative">
                    <input type="number" 
                           id="baseHydrationBP" 
                           value="65" 
                           oninput="calculate()" 
                           inputmode="decimal" 
                           pattern="[0-9]*"
                           class="input-pill w-full p-4 rounded-2xl text-xl font-bold bg-white">
                    <span class="absolute right-4 top-1/2 -translate-y-1/2 font-bold text-amber-600">%</span>
                </div>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="ingredientGrid">
                <!-- Dynamically generated checkboxes -->
            </div>
        </section>

        <!-- Dynamic Recipe Result -->
        <section id="recipeSection" class="card overflow-hidden border border-stone-100 scroll-mt-6">
            <div class="bg-stone-800 p-4 flex justify-between items-center text-white">
                <h3 class="font-bold uppercase tracking-widest text-[10px]">Ingredient List</h3>
                <span class="text-[10px] opacity-60 uppercase">1.0% Yeast Incl.</span>
            </div>
            <div id="recipeOutput" class="divide-y divide-stone-100">
                <!-- Ingredients go here -->
            </div>
            <div class="p-4 bg-stone-50 flex justify-between items-center font-black border-t border-stone-200">
                <span class="text-sm">TOTAL WEIGHT</span>
                <span id="finalTotalDisplay" class="text-xl text-amber-600">0g</span>
            </div>
        </section>

        <!-- Pro Alerts -->
        <div id="alertContainer" class="space-y-3 pb-4"></div>

    </main>

    <!-- Sticky Bottom Summary -->
    <div class="sticky-result sm:hidden">
        <div class="flex flex-col">
            <p class="text-[8px] font-bold uppercase tracking-widest opacity-60">TARGET DOUGH</p>
            <p id="stickyWeight" class="text-lg font-black leading-tight">0g</p>
        </div>
        <button onclick="scrollToRecipe()" class="bg-amber-500 text-white px-4 py-2 rounded-xl font-bold text-xs shadow-lg active:scale-95 transition-transform">
            VIEW RECIPE
        </button>
    </div>

    <script>
        let isMetric = true;
        let selectedRatio = 1.78;
        
        const ingredients = [
            { id: 'optGluten', name: 'Vital Wheat Gluten', bp: 3, type: 'flour', tip: 'Increases protein for better rise and a chewier texture.' },
            { id: 'optSalt', name: 'Fine Sea Salt', bp: 1.8, type: 'other', tip: 'Essential for flavor and controlling yeast activity.' },
            { id: 'optButter', name: 'Unsalted Butter', bp: 10, type: 'other', tip: 'Enriches the crumb and softens the crust texture.' },
            { id: 'optHoney', name: 'Honey/Sugar', bp: 8, type: 'other', liq: 0.2, tip: 'Feeds yeast and helps the crust brown beautifully.' },
            { id: 'optSourdough', name: 'Active Starter', bp: 20, type: 'comp', liq: 0.5, flour: 0.5, excl: 'optRewana', tip: '100% hydration natural sourdough starter.' },
            { id: 'optRewana', name: 'Rewana Bug', bp: 20, type: 'comp', liq: 0.5, flour: 0.5, excl: 'optSourdough', tip: 'Traditional Maori potato-based bug for leavening.' },
            { id: 'optMilk', name: 'Whole Milk', bp: 60, type: 'liq_opt', liq: 0.9, excl: 'optWater', tip: 'Replaces water for a softer, richer milky loaf.' },
            { id: 'optWater', name: 'Pure Water', bp: 0, type: 'liq_opt', liq: 1, excl: 'optMilk', tip: 'Standard hydration liquid for a crisp crust.' },
            { id: 'optEgg', name: 'Fresh Egg', bp: 12, type: 'other', liq: 0.75, tip: 'Adds structure, richness, and a golden hue.' },
            { id: 'optOnion', name: 'Sautéed Onion', bp: 25, type: 'other', liq: 0.9, note: 'Sauté and cool onions before adding.', tip: 'Intense savory flavor addition.' },
            { id: 'optCC', name: 'Cottage Cheese', bp: 20, type: 'other', liq: 0.8, note: 'Liquify cheese in blender first.', tip: 'Adds incredible moistness and protein.' }
        ];

        function init() {
            const grid = document.getElementById('ingredientGrid');
            ingredients.forEach(ing => {
                const div = document.createElement('div');
                div.className = "has-tooltip h-full";
                div.innerHTML = `
                    <input type="checkbox" id="${ing.id}" class="hidden peer" onchange="handleIngChange('${ing.id}')">
                    <label for="${ing.id}" class="block p-3 border-2 border-stone-100 rounded-2xl text-[10px] font-bold text-center cursor-pointer peer-checked:bg-amber-500 peer-checked:border-amber-500 peer-checked:text-white transition-all h-full w-full flex items-center justify-center shadow-sm">
                        ${ing.name.toUpperCase()}
                    </label>
                    <div class="tooltip">${ing.tip || 'Custom ingredient addition.'}</div>
                `;
                grid.appendChild(div);
            });
            document.getElementById('optWater').checked = true;
            calculate();
        }

        function handleIngChange(id) {
            const current = ingredients.find(i => i.id === id);
            if (current && current.excl) {
                const other = document.getElementById(current.excl);
                if (document.getElementById(id).checked) other.checked = false;
            }
            calculate();
        }

        function setRatio(val, btn) {
            selectedRatio = val;
            document.querySelectorAll('.ratio-btn').forEach(b => {
                b.classList.remove('border-amber-500', 'bg-amber-50', 'text-amber-700');
                b.classList.add('border-stone-100', 'bg-white');
            });
            btn.classList.add('border-amber-500', 'bg-amber-50', 'text-amber-700');
            btn.classList.remove('border-stone-100', 'bg-white');
            calculate();
        }

        function toggleUnits() {
            isMetric = !isMetric;
            document.getElementById('unitToggle').textContent = isMetric ? 'METRIC (g)' : 'IMPERIAL (oz)';
            document.querySelectorAll('.unit-label').forEach(l => l.textContent = isMetric ? 'g' : 'oz');
            calculate();
        }

        function convert(grams) {
            return isMetric ? Math.round(grams) : (grams * 0.035274).toFixed(2);
        }

        function scrollToRecipe() {
            document.getElementById('recipeSection').scrollIntoView({ behavior: 'smooth' });
        }

        function calculate() {
            const volume = parseFloat(document.getElementById('tinVolume').value) || 0;
            const targetHydration = parseFloat(document.getElementById('baseHydrationBP').value) || 0;

            const targetDoughWeight = volume / selectedRatio;
            
            let totalLiqBP = 0;
            let activeExtras = [];

            ingredients.forEach(ing => {
                if (document.getElementById(ing.id).checked) {
                    if (ing.type !== 'liq_opt') {
                        activeExtras.push(ing);
                        if (ing.liq) totalLiqBP += (ing.bp * ing.liq);
                    }
                }
            });

            let baseLiqBP = Math.max(0, targetHydration - totalLiqBP);
            let baseLiquidObj = document.getElementById('optMilk').checked ? 
                                ingredients.find(i => i.id === 'optMilk') : 
                                ingredients.find(i => i.id === 'optWater');

            const yeastBP = 1.0;
            let totalRecipeBP = 100 + yeastBP + baseLiqBP;
            activeExtras.forEach(e => totalRecipeBP += e.bp);

            const TFW = targetDoughWeight / (totalRecipeBP / 100);

            const output = [];
            output.push({ name: 'Bread Flour', w: TFW });
            output.push({ name: 'Instant Yeast', w: TFW * (yeastBP / 100) });
            output.push({ name: baseLiquidObj.name, w: TFW * (baseLiqBP / 100) });
            
            activeExtras.forEach(e => {
                output.push({ name: e.name, w: TFW * (e.bp / 100) });
            });

            render(output, targetDoughWeight);
        }

        function render(items, total) {
            const container = document.getElementById('recipeOutput');
            const alerts = document.getElementById('alertContainer');
            container.innerHTML = '';
            alerts.innerHTML = '';

            items.forEach(item => {
                const row = document.createElement('div');
                row.className = 'p-4 flex justify-between items-center animate-pop';
                row.innerHTML = `
                    <span class="text-sm font-semibold text-stone-600">${item.name}</span>
                    <span class="font-bold text-stone-900">${convert(item.w)}${isMetric ? 'g' : 'oz'}</span>
                `;
                container.appendChild(row);
                
                const ref = ingredients.find(i => i.name === item.name);
                if (ref && ref.note) {
                    const alert = document.createElement('div');
                    alert.className = 'p-4 bg-amber-50 border-l-4 border-amber-500 text-amber-900 text-[11px] font-bold rounded-r-xl shadow-sm';
                    alert.innerHTML = `PRO TIP: ${ref.note}`;
                    alerts.appendChild(alert);
                }
            });

            const totalText = convert(total) + (isMetric ? 'g' : 'oz');
            document.getElementById('finalTotalDisplay').textContent = totalText;
            document.getElementById('stickyWeight').textContent = totalText;
        }

        function saveCurrentTin() {
            const name = prompt("Name this tin (e.g. 2lb Loaf Pan):");
            if (name) {
                const vol = document.getElementById('tinVolume').value;
                const saved = JSON.parse(localStorage.getItem('saved_tins') || '[]');
                saved.push({ name, vol });
                localStorage.setItem('saved_tins', JSON.stringify(saved));
            }
        }

        window.onload = init;
    </script>
</body>
</html>